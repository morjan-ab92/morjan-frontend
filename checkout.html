<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="checkout.title">J&A Jewelry - Checkout</title>
    <link rel="icon" href="data:,">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Cairo:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, doc, getDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebase = { auth, db };
    </script>
    
    <!-- Stripe -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <style>
        /* Checkout Page - Dark Background */
        body {
            background: #000 !important;
            color: #fff !important;
        }
        
        html {
            background: #000 !important;
        }
        
        /* Checkout Page Specific Styles */
        .checkout-container {
            max-width: 1400px;
            margin: 100px auto 20px auto;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            min-height: calc(100vh - 200px);
        }
        
        main {
            background: #000 !important;
        }
        
        .checkout-main {
            background: #0a0a0a;
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }
        
        .checkout-sidebar {
            background: #0a0a0a;
            border-radius: 12px;
            padding: 2rem;
            border: 1px solid rgba(212, 175, 55, 0.2);
            height: fit-content;
            position: sticky;
            top: 100px;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }
        
        .checkout-sidebar h3 {
            color: var(--gold);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        .checkout-step {
            margin-bottom: 3rem;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--gold);
            color: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        
        .step-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color var(--transition-fast);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--gold);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .delivery-methods,
        .payment-methods {
            display: grid;
            gap: 1rem;
        }
        
        .delivery-method,
        .payment-method {
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            background: #2a2a2a;
        }
        
        .delivery-method:hover,
        .payment-method:hover {
            border-color: var(--gold);
        }
        
        .delivery-method.selected,
        .payment-method.selected {
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.1);
        }
        
        .delivery-method input[type="radio"],
        .payment-method input[type="radio"] {
            margin: 0;
            margin-top: 2px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        
        #deliveryAreaSection {
            display: block;
        }
        
        #shippingInfoSection {
            display: block;
        }
        
        #shippingInfoSection.hidden {
            display: none;
        }
        
        #deliveryAreaSection.hidden {
            display: none;
        }
        
        .order-summary {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .order-summary::-webkit-scrollbar {
            width: 6px;
        }
        
        .order-summary::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }
        
        .order-summary::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 3px;
        }
        
        .order-summary::-webkit-scrollbar-thumb:hover {
            background: var(--gold-light);
        }
        
        .order-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.25rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .order-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .order-item-image {
            width: 60px;
            height: 60px;
            background: var(--bg-secondary);
            border-radius: 6px;
            object-fit: cover;
            border: 1px solid rgba(212, 175, 55, 0.3);
            flex-shrink: 0;
        }
        
        .order-item-info {
            flex: 1;
            min-width: 0;
        }
        
        .order-item-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
            font-size: 1rem;
        }
        
        .order-item-brand {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .order-item-qty-price {
            color: var(--gold);
            font-weight: 500;
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }
        
        .order-item-total {
            color: var(--gold);
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 100px;
            text-align: right;
        }

        [dir="rtl"] .order-item-total {
            text-align: left;
        }
        
        .order-totals {
            border-top: 2px solid rgba(212, 175, 55, 0.3);
            padding-top: 1.5rem;
            margin-top: 1rem;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        
        .total-row.final {
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--gold);
            border-top: 2px solid rgba(212, 175, 55, 0.3);
            padding-top: 1rem;
            margin-top: 1rem;
            margin-bottom: 0;
        }
        
        .btn-checkout {
            width: 100%;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--bg-primary);
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }
        
        .btn-checkout:hover {
            background: linear-gradient(135deg, var(--gold-light), var(--gold));
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
        }
        
        .btn-checkout:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.6;
        }
        
        .btn-apply-coupon:hover {
            background: var(--gold-light) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }
        
        .btn-apply-coupon:disabled {
            background: #555 !important;
            cursor: not-allowed;
            transform: none;
            opacity: 0.6;
        }
        
        #couponMessage.error {
            color: #ff3b3b;
        }
        
        #couponMessage.success {
            color: #4caf50;
        }
        
        .auth-section {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .auth-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        @media (max-width: 768px) {
            .auth-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        .btn-auth {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--gold);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--gold);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        
        .btn-auth:hover {
            border-color: var(--gold-light);
            background: rgba(212, 175, 55, 0.15);
            color: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }
        
        .btn-auth.google {
            background: #4285f4;
            color: white;
            border-color: #4285f4;
        }
        
        .btn-auth.google:hover {
            background: #357ae8;
            border-color: #357ae8;
            color: white;
        }
        
        /* Delivery Method Styles */
        .delivery-option {
            transition: all 0.3s ease;
        }
        
        .delivery-option:hover {
            background: rgba(212, 175, 55, 0.05);
        }
        
        .delivery-option input[type="radio"]:checked + span {
            color: var(--gold);
            font-weight: 600;
        }
        
        #regionSelection {
            margin-top: 1rem;
        }
        
        #pickupNote {
            margin-top: 1rem;
        }
        
        #addressFields {
            margin-top: 1rem;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            display: none;
            background: rgba(255, 59, 59, 0.1);
            border: 1px solid #ff3b3b;
            color: #ff3b3b;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .error-message.show {
            display: block;
        }
        
        .success-message {
            display: none;
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4caf50;
            color: #4caf50;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .success-message.show {
            display: block;
        }
        
        /* RTL Support */
        [dir="rtl"] .form-row {
            direction: rtl;
        }
        
        [dir="rtl"] .order-item {
            direction: rtl;
        }
        
        [dir="rtl"] .order-item-image {
            margin-left: 0;
            margin-right: 0;
        }
        
        [dir="rtl"] .total-row {
            direction: rtl;
        }
        
        [dir="rtl"] .step-header {
            direction: rtl;
        }
        
        [dir="rtl"] .step-number {
            margin-left: 0;
            margin-right: 1rem;
        }
        
        [dir="rtl"] .auth-buttons {
            direction: rtl;
        }
        
        [dir="rtl"] .payment-method,
        [dir="rtl"] .delivery-method {
            direction: rtl;
        }
        
        [dir="rtl"] #deliveryAreaSection {
            direction: rtl;
        }
        
        [dir="rtl"] #deliveryAreaSection select {
            text-align: right;
        }
        
        /* Responsive Design */
        @media (max-width: 900px) {
            .checkout-container {
                grid-template-columns: 1fr;
                gap: 2rem;
                padding: 1rem;
                margin: 20px auto;
            }
            
            .checkout-sidebar {
                position: static;
                order: -1; /* Show order summary first on mobile */
                top: 0;
            }
            
            .checkout-main {
                order: 1;
            }
        }
        
        @media (max-width: 768px) {
            .checkout-container {
                margin: 20px auto;
                padding: 1rem;
            }
            
            .checkout-main,
            .checkout-sidebar {
                padding: 1.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .step-title {
                font-size: 1.2rem;
            }
            
            .step-number {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .checkout-container {
                margin: 10px auto;
                padding: 0.5rem;
            }
            
            .checkout-main,
            .checkout-sidebar {
                padding: 1rem;
            }
            
            .auth-buttons {
                grid-template-columns: 1fr;
            }
            
            .order-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .order-item-image {
                width: 100%;
                max-width: 200px;
                height: auto;
                aspect-ratio: 1;
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header / Navbar -->
    <header class="header" style="background: #111 !important; display: flex !important; align-items: center !important; justify-content: space-between !important; padding: 0 40px !important; direction: ltr !important; flex-direction: row !important;">
        <a href="index.html" class="logo" style="font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 700; background: linear-gradient(45deg, #d4af37, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-decoration: none; transition: all 0.3s ease; color: #d4af37;">
            <span dir="ltr" class="brand-name">J&amp;A Jewelry</span>
        </a>

        <nav class="nav-links" style="display: flex !important; gap: 30px !important; align-items: center !important; flex-direction: row !important; direction: ltr !important; flex-wrap: nowrap !important; margin: 0 !important;">
            <a href="index.html" data-translate="nav-home" style="color: #d4af37 !important; text-decoration: none !important; font-size: 1rem !important; font-weight: 500 !important; white-space: nowrap !important;">Home</a>
            <a href="perfumes.html" data-translate="nav-perfumes" style="color: #d4af37 !important; text-decoration: none !important; font-size: 1rem !important; font-weight: 500 !important; white-space: nowrap !important;">Perfumes</a>
            <a href="watches.html" data-translate="nav-watches" style="color: #d4af37 !important; text-decoration: none !important; font-size: 1rem !important; font-weight: 500 !important; white-space: nowrap !important;">Watches</a>
            <a href="bags.html" data-translate="nav-bags" style="color: #d4af37 !important; text-decoration: none !important; font-size: 1rem !important; font-weight: 500 !important; white-space: nowrap !important;">Bags</a>
            <a href="accessories.html" data-translate="nav-accessories" style="color: #d4af37 !important; text-decoration: none !important; font-size: 1rem !important; font-weight: 500 !important; white-space: nowrap !important;">Accessories</a>
            <a href="#about" data-translate="nav-about" style="color: #d4af37 !important; text-decoration: none !important; font-size: 1rem !important; font-weight: 500 !important; white-space: nowrap !important;">About</a>
            <a href="#contact" data-translate="nav-contact" style="color: #d4af37 !important; text-decoration: none !important; font-size: 1rem !important; font-weight: 500 !important; white-space: nowrap !important;">Contact</a>
        </nav>

        <div class="nav-icons" style="display: flex !important; gap: 1.5rem !important; align-items: center !important; flex-direction: row !important; direction: ltr !important; flex-wrap: nowrap !important;">
            <a href="cart.html" style="color: #d4af37 !important; text-decoration: none !important; position: relative !important; display: inline-flex !important; align-items: center !important; justify-content: center !important;">
                <i class="fa-solid fa-bag-shopping" id="header-cart-icon" style="color: #d4af37 !important; font-size: 1.25rem !important;">
                    <span class="cart-badge" id="cart-badge" style="position: absolute; top: -8px; right: -8px; background: #d4af37; color: #ffffff; border-radius: 50%; min-width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: bold;">5</span>
                </i>
            </a>
            <i class="fa-solid fa-heart" style="color: #d4af37 !important; font-size: 1.25rem !important; cursor: pointer !important;"></i>
            <button onclick="window.handleUserIconClick()" style="background: none !important; border: none !important; color: inherit !important; cursor: pointer !important; padding: 0 !important;">
                <i class="fa-solid fa-user" id="header-account-icon" style="color: #d4af37 !important; font-size: 1.25rem !important;"></i>
            </button>
            <div id="user-profile-area" class="user-profile-area" style="display: flex !important; margin-left: 1.5rem !important; align-items: center !important;">
                <span id="user-greeting" class="user-greeting" style="color: #fff !important; font-size: 0.95rem !important; font-weight: 500 !important; white-space: nowrap !important;">Welcome, <span id="user-display-name" style="color: #d4af37 !important; font-weight: 600 !important;">testmorjan</span> üëë</span>
            </div>
        </div>

        <button id="lang-toggle" class="lang-switch" data-lang="ar" onclick="cycleLanguage()" style="background: #0a0a0a !important; border: 1px solid #d4af37 !important; padding: 0.5rem 1rem !important; border-radius: 25px !important; color: #d4af37 !important; font-size: 0.9rem !important; font-weight: 500 !important; cursor: pointer !important; min-width: 100px !important; text-align: center !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; margin-left: 1rem !important; white-space: nowrap !important;">English</button>
        <button class="menu-toggle" type="button" onclick="window.toggleUserDrawer()" aria-label="Open menu" aria-expanded="false" aria-controls="user-drawer">
            <i class="fa-solid fa-bars"></i>
        </button>
    </header>
    
    <!-- Login Dropdown (accessible via user icon) -->
    <div id="login-dropdown" class="login-dropdown" aria-hidden="true">
        <form id="login-form">
            <input type="email" id="login-email" placeholder="Email" required>
            <input type="password" id="login-password" placeholder="Password" required>
            <button type="submit" data-translate="auth.login">Login</button>
            <button type="button" id="login-google" data-translate="auth.google_login">Login with Google</button>
            <a href="signup.html" id="create-account-link" data-translate="auth.create_account">Create Account</a>
        </form>
        <a href="#" id="logout-link" style="display: none;" data-translate="auth.logout">Logout</a>
    </div>

    <main style="background: #000; min-height: 100vh;">
    <div class="checkout-container">
        <div class="checkout-main">
            <!-- Error/Success Messages -->
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p data-translate="checkout.processing">ÿ¨ÿßÿ±Ÿä ŸÖÿπÿßŸÑÿ¨ÿ© ÿ∑ŸÑÿ®ŸÉ...</p>
            </div>
            
            <!-- Checkout Form -->
            <form id="checkoutForm">
                <!-- Delivery Method Section -->
                <div class="checkout-step">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <h2 class="step-title" data-translate="checkout.delivery_method">Choose Delivery Method</h2>
                    </div>
                    
                    <div class="delivery-methods">
                        <label class="delivery-method" for="delivery">
                            <input type="radio" name="deliveryMethod" value="delivery" id="delivery" checked required>
                            <div>
                                <div data-translate="checkout.delivery">Delivery</div>
                                <small data-translate="checkout.delivery_desc">We deliver to your address</small>
                            </div>
                        </label>
                        
                        <label class="delivery-method" for="pickup">
                            <input type="radio" name="deliveryMethod" value="pickup" id="pickup" required>
                            <div>
                                <div data-translate="checkout.pickup">Pickup from Store</div>
                                <small data-translate="checkout.pickup_desc">Collect from our store</small>
                            </div>
                        </label>
                    </div>
                    
                    <!-- Delivery Area Selection (shown when Delivery is selected) -->
                    <div id="deliveryAreaSection" class="form-group" style="margin-top: 1.5rem;">
                        <label class="form-label" for="deliveryArea" data-translate="checkout.delivery_area">Choose your area: <span style="color: #ff3b3b;">*</span></label>
                        <select class="form-input" id="deliveryArea" name="deliveryArea" required>
                            <option value="" data-translate="checkout.select_area">-- Select Area --</option>
                            <option value="baqa" data-price="25" data-translate="checkout.area_baqa">Baqa al-Gharbiyye (‚Ç™25)</option>
                            <option value="jatt" data-price="25" data-translate="checkout.area_jatt">Jatt (‚Ç™25)</option>
                            <option value="meiser" data-price="25" data-translate="checkout.area_meiser">Meiser (‚Ç™25)</option>
                            <option value="other" data-price="70" data-translate="checkout.area_other">Other areas (‚Ç™70)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Shipping Information Section -->
                <div class="checkout-step" id="shippingInfoSection">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <h2 class="step-title" data-translate="checkout.shipping_title">ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ¥ÿ≠ŸÜ</h2>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="firstName" data-translate="checkout.first_name">First Name <span style="color: #ff3b3b;">*</span></label>
                            <input type="text" class="form-input" id="firstName" name="firstName" required placeholder="First Name">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="lastName" data-translate="checkout.last_name">Last Name <span style="color: #ff3b3b;">*</span></label>
                            <input type="text" class="form-input" id="lastName" name="lastName" required placeholder="Last Name">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="email" data-translate="checkout.email">Email <span style="color: #ff3b3b;">*</span></label>
                        <input type="email" class="form-input" id="email" name="email" required placeholder="your.email@example.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phone" data-translate="checkout.phone">Phone Number <span style="color: #ff3b3b;">*</span></label>
                        <input type="tel" class="form-input" id="phone" name="phone" required placeholder="Enter your phone number">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="city" data-translate="checkout.city">City <span style="color: #ff3b3b;">*</span></label>
                        <input type="text" class="form-input" id="city" name="city" required placeholder="Enter your city">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="street" data-translate="checkout.street">Street <span style="color: #ff3b3b;">*</span></label>
                            <input type="text" class="form-input" id="street" name="street" required placeholder="Street name">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="houseNumber" data-translate="checkout.house_number">House Number <span style="color: #ff3b3b;">*</span></label>
                            <input type="text" class="form-input" id="houseNumber" name="houseNumber" required placeholder="House/Apt number">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="notes" data-translate="checkout.notes">Notes (Optional)</label>
                        <textarea class="form-input" id="notes" name="notes" rows="3" placeholder="Any additional notes for your order"></textarea>
                    </div>
                </div>
                
                <!-- Payment Method Section -->
                <div class="checkout-step">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <h2 class="step-title" data-translate="checkout.payment_title">Payment Method</h2>
                    </div>
                    
                    <div class="payment-methods">
                        <label class="payment-method" for="cash">
                            <input type="radio" name="paymentMethod" value="cash" id="cash" checked required>
                            <div>
                                <div data-translate="checkout.cash">Cash</div>
                                <small data-translate="checkout.cash_desc">Pay cash when you receive</small>
                            </div>
                        </label>
                        
                        <label class="payment-method" for="paypal">
                            <input type="radio" name="paymentMethod" value="paypal" id="paypal" required>
                            <div>
                                <div data-translate="checkout.paypal">PayPal</div>
                                <small data-translate="checkout.paypal_desc">Pay with PayPal</small>
                            </div>
                        </label>
                        
                        <label class="payment-method" for="bit">
                            <input type="radio" name="paymentMethod" value="bit" id="bit" required>
                            <div>
                                <div data-translate="checkout.bit">Bit</div>
                                <small data-translate="checkout.bit_desc">Pay with Bit</small>
                            </div>
                        </label>
                        
                        <label class="payment-method" for="credit">
                            <input type="radio" name="paymentMethod" value="credit" id="credit" required>
                            <div>
                                <div data-translate="checkout.credit.title">Credit Card</div>
                                <small data-translate="checkout.credit.note">Payment link will be sent via WhatsApp</small>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Confirm Order Button -->
                <div class="checkout-step">
                    <button type="button" class="btn-checkout" id="placeOrderBtn" onclick="placeOrder()">
                        <span data-translate="checkout.place_order">Confirm Order</span>
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Order Summary Sidebar -->
        <div class="checkout-sidebar">
            <h3 data-translate="checkout.order_summary">ŸÖŸÑÿÆÿµ ÿßŸÑÿ∑ŸÑÿ®</h3>
            
            <div class="order-summary" id="orderSummary">
                <!-- Order items will be populated here -->
            </div>
            
            <!-- Coupon Section -->
            <div class="coupon-section" style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(212, 175, 55, 0.2);">
                <label class="form-label" for="couponCode" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500;" data-translate="checkout.coupon.title">Coupon Code</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" 
                           class="form-input" 
                           id="couponCode" 
                           data-translate-placeholder="checkout.coupon.placeholder"
                           placeholder="Enter coupon code"
                           style="flex: 1; padding: 0.75rem; background: var(--bg-primary); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 1rem;"
                           maxlength="20">
                    <button type="button" 
                            id="applyCouponBtn" 
                            class="btn-apply-coupon"
                            style="padding: 0.75rem 1.5rem; background: var(--gold); color: var(--bg-primary); border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; white-space: nowrap;"
                            onclick="applyCoupon()">
                        <span data-translate="checkout.coupon.apply">Apply</span>
                    </button>
                </div>
                <div id="couponMessage" style="margin-top: 0.5rem; font-size: 0.9rem; display: none;"></div>
                <div id="couponApplied" style="margin-top: 0.75rem; display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: rgba(76, 175, 80, 0.1); border-radius: 6px; border: 1px solid rgba(76, 175, 80, 0.3);">
                        <span style="color: #4caf50; font-size: 0.9rem;">
                            <i class="fa-solid fa-check-circle"></i> 
                            <span id="appliedCouponCode" style="font-weight: 600;"></span>
                        </span>
                        <button type="button" 
                                onclick="removeCoupon()" 
                                style="background: none; border: none; color: #ff3b3b; cursor: pointer; font-size: 0.9rem; padding: 0.25rem 0.5rem;">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="order-totals">
                <div class="total-row">
                    <span data-translate="checkout.subtotal">ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÅÿ±ÿπŸä</span>
                    <span id="subtotal">‚Ç™0</span>
                </div>
                <div class="total-row" id="discountRow" style="display: none; color: #4caf50;">
                    <span data-translate="checkout.discount">Discount</span>
                    <span id="discount">-‚Ç™0</span>
                </div>
                <div class="total-row">
                    <span data-translate="checkout.shipping">ÿßŸÑÿ¥ÿ≠ŸÜ</span>
                    <span id="shipping">‚Ç™20.00</span>
                </div>
                <div class="total-row final">
                    <span data-translate="checkout.total_final">ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÜŸáÿßÿ¶Ÿä</span>
                    <span id="total">‚Ç™0</span>
                </div>
            </div>
        </div>
    </div>
    </main>

    <!-- Scripts -->
    <!-- Firebase Frontend Configuration (required for cart loading) -->
    <script type="module" src="firebase-frontend-config.js"></script>
    <script src="app.js"></script>
    <script src="assets/js/userMenu.js"></script>
    <script src="cart.js"></script>
    <script src="checkout.js"></script>
    
    <!-- Load auth_frontend.js to make checkLoginState available -->
    <script type="module" src="assets/js/auth_frontend.js"></script>
    <script type="module" src="assets/js/welcome.js"></script>
    
    <!-- Check login state on page load -->
    <script type="module">
        import { checkLoginState } from './assets/js/auth_frontend.js';
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    checkLoginState();
                    if (typeof window.displayWelcomeMessage === 'function') {
                        window.displayWelcomeMessage();
                    }
                }, 500);
            });
        } else {
            setTimeout(() => {
                checkLoginState();
                if (typeof window.displayWelcomeMessage === 'function') {
                    window.displayWelcomeMessage();
                }
            }, 500);
        }
    </script>
    
    <!-- Header Icons Navigation Handler -->
    <script>
        // Header icon navigation functions
        function goToCartPage() {
            console.warn("üî¥ NAVIGATION TRIGGERED: window.location.href = 'cart.html' (goToCartPage)", new Error().stack);
            window.location.href = 'cart.html';
        }
        
        function goToFavoritesPage() {
            console.warn("üî¥ NAVIGATION TRIGGERED: window.location.href = 'favorites.html' (goToFavoritesPage)", new Error().stack);
            window.location.href = 'favorites.html';
        }
        
        function goToLoginPage() {
            console.warn("üî¥ NAVIGATION TRIGGERED: window.location.href = 'login.html' (goToLoginPage)", new Error().stack);
            window.location.href = 'login.html';
        }
        
        // Legacy toggleMenu function removed - using user-drawer instead
        
        // Initialize header icons on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Guard: Prevent duplicate header icon initialization
            if (window.__headerIconsInitDone) {
                console.log('‚úÖ Header icons already initialized, skipping');
                return;
            }
            window.__headerIconsInitDone = true;
            
            // Cart icon - already wrapped in <a href="cart.html">, no need for event listener
            
            // Favorites icon
            const favoritesIcon = document.querySelector('.nav-icons .fa-heart');
            if (favoritesIcon) {
                favoritesIcon.style.cursor = 'pointer';
                favoritesIcon.addEventListener('click', goToFavoritesPage);
            }
            
            // User/Login icon - handled by userMenu.js (handleUserIconClick) and onclick handler in HTML
            // Menu toggle - handled by userMenu.js and onclick="window.toggleUserDrawer()" in HTML
        });
        
        // Make functions globally available
        window.goToCartPage = goToCartPage;
        window.goToFavoritesPage = goToFavoritesPage;
        window.goToLoginPage = goToLoginPage;
    </script>

    <!-- Make toggle functions globally available -->
    <script>
        // Make toggleLoginDropdown available globally
        window.toggleLoginDropdown = function toggleLoginDropdown(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            const dropdown = document.getElementById('login-dropdown');
            if (!dropdown) {
                console.error('‚ùå Login dropdown not found!');
                return;
            }
            
            const isOpening = !dropdown.classList.contains('open');
            dropdown.classList.toggle('open');
            
            if (isOpening) {
                const button = event?.target || document.getElementById('header-account-icon');
                if (button) {
                    const rect = button.getBoundingClientRect();
                    dropdown.style.top = `${rect.bottom + 8}px`;
                    if (document.documentElement.dir === 'rtl') {
                        dropdown.style.right = `${window.innerWidth - rect.right}px`;
                        dropdown.style.left = 'auto';
                    } else {
                        dropdown.style.left = `${rect.left}px`;
                        dropdown.style.right = 'auto';
                    }
                }
                dropdown.style.display = '';
                dropdown.setAttribute('aria-hidden', 'false');
            } else {
                dropdown.style.display = 'none';
                dropdown.setAttribute('aria-hidden', 'true');
            }
        };

        // Legacy toggleMobileMenu function removed - using user-drawer instead
        
        // Language toggle function - use global switchLanguage from app.js
        window.toggleLanguage = function toggleLanguage() {
            console.log('üåê Language toggle clicked');
            
            // Get current language from localStorage or default to 'en'
            const currentLang = localStorage.getItem('language') || 
                                localStorage.getItem('preferred_lang') || 
                                document.documentElement.lang || 'en';
            
            // Language cycle: EN -> AR -> HE -> EN
            const langCycle = ['en', 'ar', 'he'];
            const currentIndex = langCycle.indexOf(currentLang);
            const nextIndex = (currentIndex + 1) % langCycle.length;
            const nextLang = langCycle[nextIndex];
            
            console.log(`Switching from ${currentLang.toUpperCase()} to ${nextLang.toUpperCase()}`);
            
            // Use global switchLanguage function from app.js
            if (typeof window.switchLanguage === 'function') {
                window.switchLanguage(nextLang);
            } else {
                console.error('‚ùå switchLanguage function not available - app.js may not be loaded');
                // Fallback: manually update language
                localStorage.setItem('language', nextLang);
                localStorage.setItem('preferred_lang', nextLang);
                document.documentElement.lang = nextLang;
                document.documentElement.dir = (nextLang === 'ar' || nextLang === 'he') ? 'rtl' : 'ltr';
                document.body.setAttribute('dir', (nextLang === 'ar' || nextLang === 'he') ? 'rtl' : 'ltr');
                
                // Update button text
                const langToggleBtn = document.getElementById('lang-toggle');
                if (langToggleBtn) {
                    const langTexts = {
                        'en': 'English',
                        'ar': 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©',
                        'he': '◊¢◊ë◊®◊ô◊™'
                    };
                    langToggleBtn.textContent = langTexts[nextLang] || 'English';
                }
                
                // Trigger page reload to apply translations
                setTimeout(() => {
                    // Guard: Prevent infinite reload loops
                    // CRITICAL: DISABLED to prevent infinite reload loop
                    // if (window.__alreadyReloaded) {
                    //     console.log('‚úÖ Page already reloaded, skipping');
                    //     return;
                    // }
                    // window.__alreadyReloaded = true;
                    // window.location.reload();
                    console.warn('‚ö†Ô∏è RELOAD DISABLED - Page reload prevented to stop infinite loop');
                }, 100);
            }
        };
        
        // Alias for cycleLanguage to match onclick handler
        window.cycleLanguage = window.toggleLanguage;
        
        // Legacy closeMobileMenu function removed - using user-drawer instead
        
        // Handle mobile logout function
        window.handleMobileLogout = async function handleMobileLogout() {
            console.log('üî• handleMobileLogout called');
            try {
                // Import logout function from auth_frontend.js
                const { logout } = await import('./assets/js/auth_frontend.js');
                console.log('‚úÖ Logout function imported');
                await logout();
                console.log('‚úÖ Logout successful');
                // Close drawer if open (handled by logout function)
            } catch (error) {
                console.error('‚ùå Mobile logout failed:', error);
                if (window.JAJewelry?.showNotification) {
                    window.JAJewelry.showNotification('Error logging out', 'error');
                }
            }
        }
    </script>
    
    <!-- Placeholder sections -->
    <section id="about"></section>
    <section id="contact"></section>

    <!-- User Account Drawer -->
    <div id="user-drawer-overlay" onclick="window.toggleUserDrawer()"></div>

    <aside id="user-drawer">
        <button class="user-drawer-close" onclick="window.toggleUserDrawer()">√ó</button>

        <div class="user-drawer-header">
            <span class="user-name" id="drawer-user-name"></span>
            <button class="logout-btn" onclick="logout()" data-translate="navigation.logout">Logout</button>
        </div>

        <nav class="user-drawer-nav">
            <a href="index.html" data-translate="navigation.home">Home</a>
            <a href="perfumes.html" data-translate="navigation.perfumes">Perfumes</a>
            <a href="watches.html" data-translate="navigation.watches">Watches</a>
            <a href="bags.html" data-translate="navigation.bags">Bags</a>
            <a href="accessories.html" data-translate="navigation.accessories">Accessories</a>
            <a href="index.html#about-section" data-translate="navigation.about">About</a>
            <a href="index.html#contact-section" data-translate="navigation.contact">Contact</a>
        </nav>
    </aside>
</body>
</html>
